{% extends 'base.html' %}
{% block title %}Ø­Ø³Ø§Ø¨ÙŠ{% endblock %}

{% block content %}
  <section class="profile-hero">
    <div class="card profile-card">
      <div class="profile-header">
        {% if profile_obj.image %}
          <div class="avatar large avatar-image">
            <img src="{{ profile_obj.image.url }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨" />
          </div>
        {% else %}
          <div class="avatar large">{{ user.username|first|upper }}</div>
        {% endif %}
        <div>
          <h1>{{ user.username }}</h1>
          <p class="subtle">{{ user.email|default:"Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„" }}</p>
        </div>
      </div>
      <form class="profile-upload" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="file-row">
          <label class="file-label" for="id_profile_image">
            <span class="file-icon">ğŸ“·</span>
            Ø§Ø®ØªØ± ØµÙˆØ±Ø©
          </label>
          <input
            id="id_profile_image"
            class="file-input"
            type="file"
            name="image"
            accept="image/*"
          />
          <button class="btn primary" type="submit">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©</button>
        </div>
      </form>
      <div class="profile-actions">
        <a class="btn ghost" href="{% url 'home' %}">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØºØ±ÙŠØ¯Ø§Øª</a>
        <form method="post" action="{% url 'delete_account' %}" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ');">
          {% csrf_token %}
          <button class="btn danger" type="submit">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </form>
      </div>
    </div>
  </section>

  <section class="timeline">
    <div class="section-title">
      <h2>ØªØºØ±ÙŠØ¯Ø§ØªÙŠ</h2>
      <span class="subtle">{{ tweets.count }} ØªØºØ±ÙŠØ¯Ø©</span>
    </div>
    <div class="tweets-list">
      {% for tweet in tweets %}
        <article class="tweet-card in-view" id="tweet-{{ tweet.id }}">
          <div class="tweet-header">
            <a class="avatar" href="{% url 'user_profile' user.username %}">
              {{ user.username|first|upper }}
            </a>
            <div>
              <h3>
                <a class="user-link" href="{% url 'user_profile' user.username %}">
                  {{ user.username }}
                </a>
              </h3>
              <span class="tweet-date">{{ tweet.created_at|date:"Y/m/d H:i" }}</span>
            </div>
          </div>
          <p class="tweet-content">{{ tweet.content }}</p>
          {% if tweet.image %}
            <div class="tweet-media">
              <img src="{{ tweet.image.url }}" alt="ØµÙˆØ±Ø© Ø§Ù„ØªØºØ±ÙŠØ¯Ø©" />
            </div>
          {% endif %}
          <div class="tweet-actions">
            <form class="js-like-form" method="post" action="{% url 'toggle_like' tweet.id %}" data-tweet-id="{{ tweet.id }}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}#tweet-{{ tweet.id }}" />
              <button class="btn ghost like-btn" type="submit">
                {% if tweet.id in liked_ids %}
                  â¤ï¸ Ø£Ø¹Ø¬Ø¨ØªÙ†ÙŠ
                {% else %}
                  ğŸ¤ Ù„Ø§ÙŠÙƒ
                {% endif %}
                <span class="count like-count">{{ tweet.likes.count }}</span>
              </button>
            </form>
            <form method="post" action="{% url 'delete_tweet' tweet.id %}" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØªØºØ±ÙŠØ¯Ø©ØŸ');">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}#tweet-{{ tweet.id }}" />
              <button class="btn ghost danger-outline" type="submit">Ø­Ø°Ù</button>
            </form>
          </div>
        </article>
      {% empty %}
        <div class="card empty">
          <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºØ±ÙŠØ¯Ø§Øª Ù„Ùƒ Ø¨Ø¹Ø¯</h3>
          <p>Ø§Ø¨Ø¯Ø£ Ø¨ÙƒØªØ§Ø¨Ø© Ø£ÙˆÙ„ ØªØºØ±ÙŠØ¯Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>
        </div>
      {% endfor %}
    </div>
  </section>
{% endblock %}
